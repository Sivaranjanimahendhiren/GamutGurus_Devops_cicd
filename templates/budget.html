{% extends "base.html" %}
{% block content %}

<style>
:root {
  --card-radius:24px;
  --btn-radius:16px;
  --glass-bg: rgba(255,255,255,0.2);
  --btn-bg:#fff;
  --btn-hover:rgba(0,0,0,0.1);
}

body, html { margin:0; padding:0; font-family:"Inter",sans-serif; }

.budget-page {
  min-height:100vh;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:20px;
  background: linear-gradient(135deg,#ff7eb3,#7afcff,#9be15d,#ffd86b,#ff7eb3);
  background-size:600% 600%;
  animation: rainbowBG 12s ease infinite;
}

@keyframes rainbowBG { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }

.card-glass {
  background: var(--glass-bg);
  border-radius: var(--card-radius);
  box-shadow:0 15px 50px rgba(0,0,0,0.3);
  padding:20px;
  backdrop-filter: blur(15px);
}

.flex-row { display:flex; gap:20px; flex-wrap:wrap; }
.flex-col { flex:1; display:flex; flex-direction:column; gap:15px; min-width:280px; }

h3,h5 { color:#000; }

.list-group-item { background:rgba(255,255,255,0.8); }

.history, .prediction, .suggestions {
  max-height:150px;
  overflow-y:auto;
  border-top:1px dashed rgba(0,0,0,0.2);
  padding-top:10px;
  font-size:1rem;
  color:#000;
}

canvas { background:#fff; border-radius:16px; }

.btn-custom { border:none; border-radius:var(--btn-radius); padding:10px 15px; cursor:pointer; background:var(--btn-bg); transition:0.2s; font-weight:bold; }
.btn-custom:hover { background: var(--btn-hover); }

</style>

<div class="budget-page">
  <!-- Add Budget Item -->
  <div class="card-glass">
    <h5>ðŸ’° Add Budget Item</h5>
    <form method="POST" action="{{ url_for('budget_add') }}" class="row g-2">
      <div class="col-md-3">
        <select class="form-select" name="type">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
      </div>
      <div class="col-md-4">
        <input class="form-control" name="label" placeholder="Label" required>
      </div>
      <div class="col-md-3">
        <input class="form-control" type="number" step="0.01" name="amount" placeholder="Amount" required>
      </div>
      <div class="col-md-2">
        <button class="btn-custom w-100 btn-success">Add</button>
      </div>
    </form>
  </div>

  <!-- Budget Lists Side-by-side -->
  <div class="flex-row">
    <div class="flex-col card-glass">
      <h5>Income</h5>
      <ul class="list-group">
        {% for i in income_items or [] %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ i.label }} ({{ i.amount }})
            <a href="{{ url_for('budget_delete', item_id=i.id) }}" class="btn btn-sm btn-outline-danger">Delete</a>
          </li>
        {% else %}
          <li class="list-group-item text-muted">No income items.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="flex-col card-glass">
      <h5>Expenses</h5>
      <ul class="list-group">
        {% for e in expense_items or [] %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ e.label }} ({{ e.amount }})
            <a href="{{ url_for('budget_delete', item_id=e.id) }}" class="btn btn-sm btn-outline-danger">Delete</a>
          </li>
        {% else %}
          <li class="list-group-item text-muted">No expense items.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Charts + Predictions -->
  <div class="flex-row">
    <div class="flex-col card-glass">
      <h5>ðŸ“Š Budget Trends</h5>
      <canvas id="budgetLineChart"></canvas>
      <canvas id="budgetPieChart" style="margin-top:15px;"></canvas>
    </div>
    <div class="flex-col card-glass">
      <h5>Predictions & Suggestions</h5>
      <div class="prediction">
        <strong>Predicted Net Balance:</strong>
        <ul>
          {% for p in predicted_values or [] %}
            <li>{{ p.date }}: {{ p.amount }}</li>
          {% else %}
            <li class="text-muted">No predictions yet.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="suggestions">
        <strong>Suggestions:</strong>
        <ul>
          {% for s in suggestions or [] %}
            <li>{{ s }}</li>
          {% else %}
            <li class="text-muted">No suggestions yet.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="history">
        <strong>Past Budget Actions:</strong>
        <ul>
          {% for h in past_actions or [] %}
            <li>{{ h }}</li>
          {% else %}
            <li class="text-muted">No past actions.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctxLine = document.getElementById('budgetLineChart').getContext('2d');
const budgetLineChart = new Chart(ctxLine, {
  type:'line',
  data:{
    labels: {{ past_dates or [] | tojson }},
    datasets:[{
      label:'Net Balance',
      data: {{ net_values or [] | tojson }},
      borderColor:'rgba(75,192,192,1)',
      backgroundColor:'rgba(75,192,192,0.2)',
      fill:true,
      tension:0.4
    }]
  },
  options:{ responsive:true, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:true } } }
});

const ctxPie = document.getElementById('budgetPieChart').getContext('2d');
const budgetPieChart = new Chart(ctxPie,{
  type:'pie',
  data:{
    labels: {{ pie_labels or [] | tojson }},
    datasets:[{
      data: {{ pie_values or [] | tojson }},
      backgroundColor: ['#ff6384','#36a2eb','#ffce56','#9be15d','#7afcff'],
      borderWidth:1
    }]
  },
  options:{ responsive:true }
});
</script>

{% endblock %}
